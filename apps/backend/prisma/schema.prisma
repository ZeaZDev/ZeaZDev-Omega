// ZeaZDev [Backend - Prisma Schema] //
// Project: ZeaZDev FiGaTect Super-App //
// Version: 1.0.0 (Omega Scaffolding) //
// Author: ZeaZDev Meta-Intelligence (Generated) //
// --- DO NOT EDIT HEADER --- //

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  worldIdHash   String?   @unique
  walletAddress String    @unique
  email         String?   @unique
  username      String?   @unique
  avatar        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?

  // Relationships
  stakes                 Stake[]
  gameSessions           GameSession[]
  gameStats              GameStats?
  tournamentParticipants TournamentParticipant[]
  fintechUser            FintechUser?
  rewards                RewardClaim[]
  referrals              Referral[]              @relation("Referrer")
  referredBy             Referral[]              @relation("Referee")
  leaderboard            GameLeaderboard[]

  @@index([walletAddress])
  @@index([worldIdHash])
}

model Stake {
  id                  String   @id @default(uuid())
  userId              String
  amount              String // Store as string to handle BigInt
  startTime           DateTime @default(now())
  lastClaimTime       DateTime @default(now())
  totalRewardsClaimed String   @default("0")
  active              Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([active])
}

model GameSession {
  id          String    @id @default(uuid())
  sessionId   String    @unique
  userId      String
  gameType    String // "slots", "poker", etc.
  betAmount   String
  winAmount   String    @default("0")
  tokenUsed   String // "ZEA" or "DING"
  result      String // "WON" or "LOST"
  status      String // "playing", "won", "lost"
  metadata    String? // JSON metadata
  txHash      String?   @unique
  createdAt   DateTime  @default(now())
  completedAt DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionId])
  @@index([gameType])
  @@index([status])
}

model GameStats {
  userId        String   @id
  totalGames    Int      @default(0)
  totalWon      Int      @default(0)
  totalLost     Int      @default(0)
  totalWinnings String   @default("0")
  winStreak     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model NFTReward {
  id              Int      @id @default(autoincrement())
  userId          String
  achievementType String
  name            String
  description     String
  imageUrl        String
  rarity          Int
  claimed         Boolean  @default(false)
  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([achievementType])
}

model Tournament {
  id        Int      @id @default(autoincrement())
  name      String
  startTime DateTime
  endTime   DateTime
  entryFee  String
  prizePool String
  status    String   @default("UPCOMING") // "UPCOMING" | "ACTIVE" | "FINISHED"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  participants TournamentParticipant[]

  @@index([status])
}

model TournamentParticipant {
  id           Int      @id @default(autoincrement())
  tournamentId Int
  userId       String
  totalWins    String   @default("0")
  gamesPlayed  Int      @default(0)
  createdAt    DateTime @default(now())

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, userId])
  @@index([tournamentId])
  @@index([userId])
}

model FintechUser {
  id                String   @id @default(uuid())
  userId            String   @unique
  cardNumber        String?  @unique
  cardStatus        String   @default("pending") // "pending", "active", "blocked"
  bankAccountLinked Boolean  @default(false)
  kycStatus         String   @default("pending") // "pending", "verified", "rejected"
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user         User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions FintechTransaction[]

  @@index([userId])
  @@index([cardNumber])
}

model FintechTransaction {
  id            String    @id @default(uuid())
  fintechUserId String
  type          String // "deposit", "withdrawal", "card_payment"
  amount        String
  currency      String    @default("THB")
  status        String // "pending", "completed", "failed"
  txHash        String?
  externalRef   String?   @unique
  createdAt     DateTime  @default(now())
  completedAt   DateTime?

  fintechUser FintechUser @relation(fields: [fintechUserId], references: [id], onDelete: Cascade)

  @@index([fintechUserId])
  @@index([status])
  @@index([type])
}

model RewardClaim {
  id            String    @id @default(uuid())
  userId        String
  rewardType    String // "daily_checkin", "airdrop", "referral"
  amount        String
  tokenType     String // "ZEA" or "DING"
  nullifierHash String    @unique
  txHash        String?   @unique
  claimed       Boolean   @default(false)
  createdAt     DateTime  @default(now())
  claimedAt     DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([rewardType])
  @@index([nullifierHash])
}

model Referral {
  id            String   @id @default(uuid())
  referrerId    String
  refereeId     String
  rewardClaimed Boolean  @default(false)
  createdAt     DateTime @default(now())

  referrer User @relation("Referrer", fields: [referrerId], references: [id], onDelete: Cascade)
  referee  User @relation("Referee", fields: [refereeId], references: [id], onDelete: Cascade)

  @@unique([referrerId, refereeId])
  @@index([referrerId])
  @@index([refereeId])
}

model GovernanceProposal {
  id           String   @id @default(uuid())
  proposalId   String   @unique
  proposer     String
  title        String
  description  String
  targets      String[] // Array of contract addresses
  values       String[] // Array of ETH values
  calldatas    String[] // Array of encoded function calls
  startBlock   Int
  endBlock     Int
  status       String   @default("pending") // "pending", "active", "succeeded", "defeated", "executed", "canceled"
  forVotes     String   @default("0")
  againstVotes String   @default("0")
  abstainVotes String   @default("0")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  votes GovernanceVote[]

  @@index([proposalId])
  @@index([status])
}

model GovernanceVote {
  id          String   @id @default(uuid())
  proposalId  String
  voter       String
  support     Int // 0 = against, 1 = for, 2 = abstain
  votingPower String
  createdAt   DateTime @default(now())

  proposal GovernanceProposal @relation(fields: [proposalId], references: [proposalId], onDelete: Cascade)

  @@unique([proposalId, voter])
  @@index([proposalId])
  @@index([voter])
}

model GameLeaderboard {
  id            String   @id @default(uuid())
  userId        String
  gameType      String // "slots", "poker", etc.
  totalWins     Int      @default(0)
  totalLosses   Int      @default(0)
  totalWinnings String   @default("0")
  highestWin    String   @default("0")
  winStreak     Int      @default(0)
  rank          Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, gameType])
  @@index([userId])
  @@index([gameType])
  @@index([totalWinnings])
}

// Phase 6: Cross-Chain Expansion
model BridgeTransaction {
  id               String    @id @default(uuid())
  userId           String
  token            String // "ZEA" or "DING"
  amount           String
  sourceChain      Int // Chain ID
  targetChain      Int // Chain ID
  status           String // "PENDING", "COMPLETED", "FAILED"
  transactionHash  String    @unique
  completionTxHash String?
  createdAt        DateTime  @default(now())
  completedAt      DateTime?

  @@index([userId])
  @@index([status])
  @@index([transactionHash])
}

model LiquidityPool {
  id              String   @id @default(uuid())
  tokenA          String
  tokenB          String
  reserveA        String
  reserveB        String
  totalLiquidity  String   @default("0")
  chainId         Int
  contractAddress String   @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([chainId])
}

// Phase 7: Advanced GameFi
model PokerGame {
  id          String    @id @default(uuid())
  gameId      String    @unique
  smallBlind  String
  bigBlind    String
  pot         String    @default("0")
  state       String // "WAITING", "PREFLOP", "FLOP", "TURN", "RIVER", "SHOWDOWN", "ENDED"
  token       String // "ZEA" or "DING"
  winnerId    String?
  createdAt   DateTime  @default(now())
  completedAt DateTime?

  @@index([gameId])
  @@index([state])
}

model RouletteGame {
  id          String    @id @default(uuid())
  spinId      String    @unique
  userId      String
  result      Int? // 0-36
  totalBets   String    @default("0")
  totalPayout String    @default("0")
  createdAt   DateTime  @default(now())
  spunAt      DateTime?

  @@index([spinId])
  @@index([userId])
}

model SportsBet {
  id        String    @id @default(uuid())
  userId    String
  sport     String // "football", "basketball", etc.
  eventId   String
  betType   String // "match_winner", "over_under", etc.
  amount    String
  odds      String
  token     String // "ZEA" or "DING"
  status    String // "PENDING", "WON", "LOST", "CANCELLED"
  payout    String    @default("0")
  createdAt DateTime  @default(now())
  settledAt DateTime?

  @@index([userId])
  @@index([status])
  @@index([eventId])
}

// Phase 8: Enterprise Features
model WhiteLabelConfig {
  id             String   @id @default(uuid())
  orgId          String   @unique
  orgName        String
  brandName      String
  logo           String?
  primaryColor   String   @default("#4F46E5")
  secondaryColor String   @default("#06B6D4")
  domain         String?  @unique
  apiKey         String   @unique
  active         Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([orgId])
  @@index([apiKey])
}

model ApiUsage {
  id           String   @id @default(uuid())
  orgId        String
  endpoint     String
  method       String
  requestCount Int      @default(0)
  successCount Int      @default(0)
  errorCount   Int      @default(0)
  date         DateTime @default(now())

  @@index([orgId])
  @@index([date])
}

model DeveloperApp {
  id          String   @id @default(uuid())
  developerId String
  appName     String
  description String?
  apiKey      String   @unique
  apiSecret   String
  webhookUrl  String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([developerId])
  @@index([apiKey])
}

// Phase 9: Social & Community
model UserProfile {
  id             String   @id @default(uuid())
  userId         String   @unique
  displayName    String?
  bio            String?
  avatar         String?
  level          Int      @default(1)
  experience     Int      @default(0)
  followersCount Int      @default(0)
  followingCount Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([userId])
}

model Follow {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Achievement {
  id              String   @id @default(uuid())
  userId          String
  achievementType String // "first_win", "win_streak_10", etc.
  title           String
  description     String
  icon            String?
  xpReward        Int      @default(0)
  unlockedAt      DateTime @default(now())

  @@index([userId])
  @@index([achievementType])
}

model CommunityPost {
  id        String   @id @default(uuid())
  userId    String
  content   String
  likes     Int      @default(0)
  comments  Int      @default(0)
  shares    Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([createdAt])
}

// Phase 10: Advanced Analytics & AI
model UserAnalytics {
  id     String   @id @default(uuid())
  userId String
  metric String // "total_volume", "win_rate", etc.
  value  String
  period String // "daily", "weekly", "monthly"
  date   DateTime

  @@unique([userId, metric, period, date])
  @@index([userId])
  @@index([metric])
  @@index([date])
}

model AiPrediction {
  id             String   @id @default(uuid())
  userId         String
  predictionType String // "game_recommendation", "defi_strategy", etc.
  prediction     String // JSON string
  confidence     Float
  createdAt      DateTime @default(now())
  accuracy       Float? // Measured after outcome

  @@index([userId])
  @@index([predictionType])
}

model FraudAlert {
  id          String    @id @default(uuid())
  userId      String
  alertType   String // "suspicious_activity", "unusual_bet", etc.
  severity    String // "low", "medium", "high", "critical"
  description String
  resolved    Boolean   @default(false)
  createdAt   DateTime  @default(now())
  resolvedAt  DateTime?

  @@index([userId])
  @@index([severity])
  @@index([resolved])
}
