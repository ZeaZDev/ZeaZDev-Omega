name: Î©.5 Global Sync Engine
on:
Â  release:
Â  Â  types: [published]

# â¬‡ï¸ [à¹à¸à¹‰à¹„à¸‚] à¹€à¸à¸´à¹ˆà¸¡à¸•à¸±à¸§à¹à¸›à¸£ Domain à¹à¸¥à¸° Telegram
env:
  DOMAIN_NAME: ${{ vars.DOMAIN_NAME }}
  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

jobs:
Â  sync:
Â  Â  runs-on: ubuntu-latest
Â  Â  steps:
Â  Â  Â  - name: Sync Multi-Region Deployments
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  REGIONS=("tokyo" "singapore" "frankfurt")
Â  Â  Â  Â  Â  for REGION in "${REGIONS[@]}"; do
Â  Â  Â  Â  Â  Â  echo "ğŸŒ Syncing to region: $REGION"
Â  Â  Â  Â  Â  Â  ssh -i ~/.ssh/id_rsa deploy@${Project,,}-$REGION.$DOMAIN_NAME \
Â  Â  Â  Â  Â  Â  Â  "docker pull zeazdev/${Project,,}-backend:${{ github.event.release.tag_name }} && \
Â  Â  Â  Â  Â  Â  Â  Â docker pull zeazdev/${Project,,}-frontend:${{ github.event.release.tag_name }} && \
Â  Â  Â  Â  Â  Â  Â  Â docker compose -f /opt/${Project,,}-staging/docker-compose.yml up -d"
Â  Â  Â  Â  Â  done
Â  Â  Â  Â  Â  MSG="ğŸŒ ${Project} successfully synced to all regions (${REGIONS[*]})"
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  # à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸œà¹ˆà¸²à¸™ Webhook (à¸‚à¸­à¸‡à¹€à¸”à¸´à¸¡)
Â  Â  Â  Â  Â  curl -X POST -H "Content-Type: application/json" \
Â  Â  Â  Â  Â  Â  -d '{"content": "'"${MSG}"'"}' ${{ secrets.DEPLOY_WEBHOOK_URL }}

Â  Â  Â  Â  Â  # â¬‡ï¸ [à¹€à¸à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ] à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸œà¹ˆà¸²à¸™ Telegram
Â  Â  Â  Â  Â  curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
Â  Â  Â  Â  Â  Â  -d chat_id="${TELEGRAM_CHAT_ID}" \
Â  Â  Â  Â  Â  Â  -d text="${MSG}"
